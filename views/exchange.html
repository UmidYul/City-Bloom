<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>–û–±–º–µ–Ω –±–∞–ª–ª–æ–≤ ‚Äî City Bloom</title>
    <link rel="stylesheet" href="/styles.css">
</head>

<body>
    <div class="app">
        <header class="site-header">
            <a class="logo" href="/">City Bloom</a>
        </header>

        <main style="margin-top:12px">
            <div class="card">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
                    <h2 style="margin:0">–ú–∞–≥–∞–∑–∏–Ω –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–π</h2>
                    <div style="text-align:right;padding:12px;background:#f1f5f9;border-radius:8px">
                        <div class="muted" style="font-size:0.9rem">–ë–∞–ª–ª—ã</div>
                        <div style="font-size:1.5rem;font-weight:700;color:#4CAF50" id="userBalance">-</div>
                    </div>
                </div>

                <div style="margin:12px 0;display:flex;gap:8px;border-bottom:1px solid #e6e9ef;padding-bottom:12px">
                    <button id="tabProducts" class="tab-button"
                        style="background:#4CAF50;color:white;padding:8px 12px;font-size:0.9rem">–¢–æ–≤–∞—Ä—ã</button>
                    <button id="tabPromos" class="tab-button" style="padding:8px 12px;font-size:0.9rem">–ö–æ–¥—ã</button>
                </div>

                <!-- Products Tab -->
                <div id="productsTab">
                    <div id="products" style="display:grid;gap:12px"></div>
                </div>

                <!-- Promos Tab -->
                <div id="promosTab" style="display:none">
                    <div id="promosList" style="display:grid;gap:12px"></div>
                </div>
            </div>
        </main>
    </div>

    <!-- promo modal -->
    <div id="promoModal" class="modal-backdrop"
        style="display:none;align-items:center;justify-content:center;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:2000">
        <div class="modal" style="background:white;padding:20px;border-radius:12px;max-width:300px;width:90%">
            <h3 id="promoTitle" style="margin-top:0">–í–∞—à –ø—Ä–æ–º–æ–∫–æ–¥</h3>
            <div id="promoOrg" class="muted"></div>
            <div style="margin-top:12px">
                <label style="font-size:0.9rem;color:#666">–ö–æ–¥ –¥–ª—è –æ–±–º–µ–Ω–∞:</label>
                <div style="margin-top:6px;padding:12px;background:#f1f5f9;border-radius:6px;font-weight:700;font-size:1.2rem;word-break:break-all;text-align:center;cursor:pointer"
                    id="promoCode" onclick="copyToClipboard(this.textContent)">XXXX-XXXX-XXXX</div>
                <div style="text-align:center;font-size:0.85rem;color:#999;margin-top:4px">–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–æ–¥, —á—Ç–æ–±—ã
                    —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</div>
            </div>
            <div class="muted" id="promoExpiry" style="margin-top:12px;text-align:center"></div>
            <div style="text-align:right;margin-top:16px"><button id="closePromo"
                    style="padding:8px 16px">–ó–∞–∫—Ä—ã—Ç—å</button></div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav" id="bottomNav">
        <a href="/" class="nav-item">
            <span class="icon">üè†</span>
            <span>–ì–ª–∞–≤–Ω–∞—è</span>
        </a>
        <a href="/register-tree" class="nav-item">
            <span class="icon">ü™¥</span>
            <span>–ü–æ—Å–∞–¥–∫–∞</span>
        </a>
        <a href="/exchange" class="nav-item active">
            <span class="icon">üíù</span>
            <span>–ú–∞–≥–∞–∑–∏–Ω</span>
        </a>
        <a href="/ranking" class="nav-item">
            <span class="icon">üèÜ</span>
            <span>–†–µ–π—Ç–∏–Ω–≥</span>
        </a>
        <a href="#" class="nav-item" id="profileNavLink">
            <span class="icon">üë§</span>
            <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
        </a>
    </nav>

    <script>
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('–ö–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω')
            }).catch(err => {
                console.error('Failed to copy:', err)
            })
        }

        // Load user profile link
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const meRes = await fetch('/api/me')
                if (meRes.ok) {
                    const me = await meRes.json()
                    document.getElementById('profileNavLink').href = `/profile/${me.id}`
                }
            } catch (err) {
                console.error('Failed to load user:', err)
            }
        })
    </script>

    <script src="/nav.js"></script>
    <script src="/exchange.js"></script>
</body>

</html>