<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>–ú–∞–≥–∞–∑–∏–Ω ‚Äî City Bloom</title>
    <link rel="stylesheet" href="/styles.css">
</head>

<body>
    <div class="app">
        <header class="site-header">
            <a class="logo" href="/">City Bloom</a>
        </header>

        <main>
            <!-- Balance Header -->
            <div class="card" style="margin-bottom:16px">
                <div style="text-align:center">
                    <div class="text-small muted">–í–∞—à –±–∞–ª–∞–Ω—Å</div>
                    <div style="font-size:32px;font-weight:700;color:var(--accent);line-height:1;margin:8px 0"
                        id="userBalance">0</div>
                    <div class="text-small muted">–ë–∞–ª–ª–æ–≤</div>
                </div>
            </div>

            <!-- Category Pills -->
            <div class="pills" style="margin-bottom:20px">
                <button type="button" class="pill active" data-category="rewards">üéÅ –¢–æ–≤–∞—Ä—ã</button>
                <button type="button" class="pill" data-category="promos">üéüÔ∏è –ú–æ–∏ –ø—Ä–æ–º–æ</button>
            </div>

            <!-- Rewards Tab -->
            <div id="rewardsTab">
                <div id="products" style="display:grid;gap:12px"></div>
            </div>

            <!-- Promos Tab -->
            <div id="promosTab" style="display:none">
                <div id="promosList"></div>
            </div>
        </main>
    </div>

    <!-- Promo Modal -->
    <div id="promoModal" class="modal-backdrop"
        style="display:none;align-items:center;justify-content:center;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:2000;padding:20px">
        <div class="card" style="max-width:360px;width:100%;padding:24px">
            <h3 id="promoTitle" style="margin-top:0;margin-bottom:8px">Your Promo Code</h3>
            <div id="promoOrg" class="muted text-medium" style="margin-bottom:16px"></div>

            <div style="margin-bottom:16px">
                <label class="text-small muted">Code:</label>
                <div style="margin-top:8px;padding:16px;background:var(--input-bg);border-radius:12px;font-weight:700;font-size:18px;font-family:monospace;text-align:center;cursor:pointer;user-select:all"
                    id="promoCode" onclick="copyPromoCode()">LOADING...</div>
                <div style="text-align:center;font-size:12px;color:var(--text-gray);margin-top:8px">
                    Tap to copy
                </div>
            </div>

            <div class="muted text-small text-center" id="promoExpiry" style="margin-bottom:16px"></div>

            <button type="button" id="closePromo" style="width:100%">Close</button>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <a href="/" class="nav-item">
            <span class="icon">üè†</span>
            <span>–ì–ª–∞–≤–Ω–∞—è</span>
        </a>
        <a href="/register-tree" class="nav-item">
            <span class="icon">ü™¥</span>
            <span>–ü–æ—Å–∞–¥–∫–∞</span>
        </a>
        <a href="/exchange" class="nav-item active">
            <span class="icon">üíù</span>
            <span>–ú–∞–≥–∞–∑–∏–Ω</span>
        </a>
        <a href="/ranking" class="nav-item">
            <span class="icon">üèÜ</span>
            <span>–†–µ–π—Ç–∏–Ω–≥</span>
        </a>
        <a href="#" class="nav-item" id="profileNavLink">
            <span class="icon">üë§</span>
            <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
        </a>
    </nav>

    <script>
        function copyPromoCode() {
            const code = document.getElementById('promoCode').textContent
            navigator.clipboard.writeText(code).then(() => {
                const btn = document.getElementById('promoCode')
                const orig = btn.textContent
                btn.textContent = '‚úì Copied!'
                setTimeout(() => btn.textContent = orig, 1500)
            }).catch(err => {
                console.error('Failed to copy:', err)
                alert('Could not copy code')
            })
        }

        // Load user profile link
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const meRes = await fetch('/api/me')
                if (meRes.ok) {
                    const me = await meRes.json()
                    document.getElementById('profileNavLink').href = `/profile/${me.id}`
                }
            } catch (err) {
                console.error('Failed to load user:', err)
            }
        })
    </script>

    <script src="/nav.js"></script>
    <script src="/exchange.js"></script>
</body>

</html>