<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>–î–æ–±–∞–≤–∏—Ç—å –ø–æ—Å–∞–¥–∫—É ‚Äî City Bloom</title>
    <link rel="stylesheet" href="/styles.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>

<body>
    <div class="app">
        <header class="site-header">
            <a class="logo" href="/">City Bloom</a>
        </header>

        <main>
            <!-- Hero Card -->
            <div class="hero" style="margin-bottom:20px">
                <div style="font-size:48px">üå±</div>
                <div style="flex:1">
                    <h1 style="margin-bottom:6px">Register your planting</h1>
                    <p class="muted text-medium" style="margin:0">–°–∞–∂–∞–π. –£—Ö–∞–∂–∏–≤–∞–π. –ó–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π.</p>
                </div>
            </div>

            <!-- Form Card -->
            <div class="card">
                <form id="plantForm" enctype="multipart/form-data">
                    <div style="margin-bottom:16px">
                        <label for="title">–ù–∞–∑–≤–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                        <input type="text" id="title" name="title" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ú–æ–π –¥—É–±–∏–∫" />
                    </div>

                    <div style="margin-bottom:16px">
                        <label>–¢–∏–ø —Ä–∞—Å—Ç–µ–Ω–∏—è</label>
                        <div class="pills">
                            <button type="button" class="pill active" data-type="Tree">üå≥ –î–µ—Ä–µ–≤–æ</button>
                            <button type="button" class="pill" data-type="Shrub">üåø –ö—É—Å—Ç–∞—Ä–Ω–∏–∫</button>
                            <button type="button" class="pill" data-type="Flower">üå∏ –¶–≤–µ—Ç–æ–∫</button>
                            <button type="button" class="pill" data-type="Other">ü™¥ –î—Ä—É–≥–æ–µ</button>
                        </div>
                        <input type="hidden" id="plantType" name="plantType" value="Tree" />
                    </div>

                    <div style="margin-bottom:16px">
                        <label for="location">–ê–¥—Ä–µ—Å / –º–µ—Å—Ç–æ</label>
                        <div style="display:flex;gap:8px">
                            <input type="text" id="location" name="location" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ –∏–ª–∏ –∞–¥—Ä–µ—Å"
                                style="flex:1" />
                            <button type="button" class="ghost" id="geoBtn"
                                style="flex-shrink:0;width:50px;padding:0">üìç</button>
                        </div>
                    </div>

                    <div style="margin-bottom:16px">
                        <label>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã</label>
                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
                            <input type="text" id="lat" name="lat" placeholder="–®–∏—Ä–æ—Ç–∞" readonly
                                style="background:var(--input-bg);cursor:default" />
                            <input type="text" id="lng" name="lng" placeholder="–î–æ–ª–≥–æ—Ç–∞" readonly
                                style="background:var(--input-bg);cursor:default" />
                        </div>
                        <div id="map" style="height:200px;border-radius:14px;margin-top:8px;overflow:hidden"></div>
                    </div>

                    <div style="margin-bottom:16px">
                        <label for="description">–û–ø–∏—Å–∞–Ω–∏–µ / –∑–∞–º–µ—Ç–∫–∏</label>
                        <textarea id="description" name="description" rows="4"
                            placeholder="–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ –≤–∞—à–µ–º —Ä–∞—Å—Ç–µ–Ω–∏–∏..."></textarea>
                    </div>

                    <div style="margin-bottom:16px">
                        <label>–í–∏–¥–µ–æ ‚Äî –î–û –ø–æ—Å–∞–¥–∫–∏</label>
                        <div class="upload-zone" id="beforeZone">
                            <div style="font-size:32px;margin-bottom:8px">üìπ</div>
                            <div class="text-medium muted">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ –≤–∏–¥–µ–æ</div>
                            <input type="file" id="beforeVideo" name="beforeVideo" accept="video/*"
                                style="display:none" />
                        </div>
                    </div>

                    <div style="margin-bottom:20px">
                        <label>–í–∏–¥–µ–æ ‚Äî –ü–û–°–õ–ï –ø–æ—Å–∞–¥–∫–∏</label>
                        <div class="upload-zone" id="afterZone">
                            <div style="font-size:32px;margin-bottom:8px">üìπ</div>
                            <div class="text-medium muted">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ –≤–∏–¥–µ–æ</div>
                            <input type="file" id="afterVideo" name="afterVideo" accept="video/*"
                                style="display:none" />
                        </div>
                    </div>

                    <div id="errorMsg" style="color:#b00020;font-size:14px;margin-bottom:12px;display:none"></div>

                    <button type="submit" id="submitBtn" style="width:100%">
                        <span id="submitText">Plant it!</span>
                    </button>

                    <!-- Upload Progress Bar -->
                    <div id="uploadProgress" style="display:none;margin-top:16px">
                        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
                            <span class="text-medium" style="font-weight:600">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                            <span id="progressPercent" class="text-medium"
                                style="font-weight:700;color:var(--accent)">0%</span>
                        </div>
                        <div class="progress-bar"
                            style="height:8px;background:var(--input-bg);border-radius:10px;overflow:hidden">
                            <div class="progress-bar-fill" id="progressBar"
                                style="width:0%;height:100%;background:var(--accent);transition:width 0.3s ease-out">
                            </div>
                        </div>
                        <div id="uploadStatus" class="text-small muted" style="margin-top:6px;text-align:center">
                            –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞...</div>
                    </div>
                </form>
            </div>
        </main>
    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <a href="/" class="nav-item">
            <span class="icon">üè†</span>
            <span>–ì–ª–∞–≤–Ω–∞—è</span>
        </a>
        <a href="/register-tree" class="nav-item active">
            <span class="icon">ü™¥</span>
            <span>–ü–æ—Å–∞–¥–∫–∞</span>
        </a>
        <a href="/map" class="nav-item">
            <span class="icon">üó∫Ô∏è</span>
            <span>–ö–∞—Ä—Ç–∞</span>
        </a>
        <a href="/exchange" class="nav-item">
            <span class="icon">üíù</span>
            <span>–ú–∞–≥–∞–∑–∏–Ω</span>
        </a>
        <a href="#" class="nav-item" id="profileNavLink">
            <span class="icon">üë§</span>
            <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
        </a>
    </nav>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const meRes = await fetch('/api/me')
                if (meRes.ok) {
                    const me = await meRes.json()
                    document.getElementById('profileNavLink').href = `/profile/${me.id}`
                }
            } catch (err) {
                console.error('Failed to load user:', err)
            }
        })
    </script>
    <script src="/nav.js"></script>
    <script src="/register_tree.js"></script>
</body>

</html>